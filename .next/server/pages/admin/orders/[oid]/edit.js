"use strict";(()=>{var e={};e.id=731,e.ids=[731,888,660],e.modules={6222:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>g,default:()=>p,getServerSideProps:()=>x,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>j,routeModule:()=>P,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>v});var a=r(7093),i=r(5244),n=r(1323),d=r(9209),l=r.n(d),o=r(9597),c=r(1499),u=e([o,c]);[o,c]=u.then?(await u)():u;let p=(0,n.l)(c,"default"),h=(0,n.l)(c,"getStaticProps"),m=(0,n.l)(c,"getStaticPaths"),x=(0,n.l)(c,"getServerSideProps"),g=(0,n.l)(c,"config"),j=(0,n.l)(c,"reportWebVitals"),v=(0,n.l)(c,"unstable_getStaticProps"),S=(0,n.l)(c,"unstable_getStaticPaths"),y=(0,n.l)(c,"unstable_getStaticParams"),f=(0,n.l)(c,"unstable_getServerProps"),b=(0,n.l)(c,"unstable_getServerSideProps"),P=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin/orders/[oid]/edit",pathname:"/admin/orders/[oid]/edit",bundlePath:"",filename:""},components:{App:o.default,Document:l()},userland:c});s()}catch(e){s(e)}})},1499:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>OrderEdit});var a=r(997),i=r(1163),n=r(5941),d=r(1842),l=r(3142),o=r(6689),c=r(3590),u=r(1664),p=r.n(u),h=e([n,d,l,c]);[n,d,l,c]=h.then?(await h)():h;let fetcher=e=>d.Z.get(e,{params:{_t:Date.now()}});function OrderEdit(){let e=(0,i.useRouter)(),{oid:t}=e.query,{data:r,error:s,mutate:u}=(0,n.default)(t?`/order/order-details/${t}`:null,fetcher),[h,m]=(0,o.useState)({orderStatus:"",paymentStatus:"",note:"",selectedShippingOption:{}}),[x,g]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{if(r){let e=r?.order||r;m({orderStatus:e.orderStatus||"",paymentStatus:e.paymentStatus||"",note:e.note||"",selectedShippingOption:e.selectedShippingOption||{}})}},[r]),s)return a.jsx(l.Z,{title:"Edit Order",children:a.jsx("div",{className:"card",children:"❌ Error loading order"})});if(!r)return a.jsx(l.Z,{title:"Edit Order",children:a.jsx("div",{className:"card",children:"⏳ Loading…"})});let j=r?.order||r;function handleChange(e){let{name:t,value:r}=e.target;m(e=>({...e,[t]:r}))}async function handleSave(r){r.preventDefault(),g(!0);try{await d.Z.put("/order/update-status",{orderId:t,orderStatus:h.orderStatus,paymentStatus:h.paymentStatus,note:h.note,selectedShippingOption:h.selectedShippingOption}),c.toast.success("Order updated"),u(),setTimeout(()=>e.push("/admin/orders"),400)}catch(e){console.error(e),c.toast.error(e?.response?.data?.message||"Failed to update order")}finally{g(!1)}}async function handleCancel(){if(confirm("Cancel this order?"))try{await d.Z.delete(`/order/cancel-order/${j.orderId||t}`),c.toast.success("Order cancelled"),u(),setTimeout(()=>e.push("/admin/orders"),400)}catch(e){console.error(e),c.toast.error("Failed to cancel order")}}return(0,a.jsxs)(l.Z,{title:`Edit Order ${j.orderId||t}`,children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,a.jsxs)("h2",{children:["Edit Order ",j.orderId||t]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[a.jsx(p(),{href:`/admin/orders/${j.orderId||t}/view`,legacyBehavior:!0,children:a.jsx("a",{className:"btn ghost",children:"View"})}),a.jsx("button",{className:"btn",onClick:handleCancel,style:{background:"#ef4444"},children:"Cancel Order"})]})]}),a.jsx("form",{onSubmit:handleSave,children:a.jsx("div",{className:"card",children:(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px",gap:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"form-row",children:[a.jsx("label",{children:"Order Status"}),(0,a.jsxs)("select",{name:"orderStatus",value:h.orderStatus,onChange:handleChange,children:[a.jsx("option",{value:"Pending",children:"Pending"}),a.jsx("option",{value:"Confirmed",children:"Confirmed"}),a.jsx("option",{value:"Processing",children:"Processing"}),a.jsx("option",{value:"Shipped",children:"Shipped"}),a.jsx("option",{value:"Delivered",children:"Delivered"}),a.jsx("option",{value:"Completed",children:"Completed"}),a.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),(0,a.jsxs)("div",{className:"form-row",children:[a.jsx("label",{children:"Payment Status"}),(0,a.jsxs)("select",{name:"paymentStatus",value:h.paymentStatus,onChange:handleChange,children:[a.jsx("option",{value:"Pending",children:"Pending"}),a.jsx("option",{value:"Paid",children:"Paid"}),a.jsx("option",{value:"Failed",children:"Failed"}),a.jsx("option",{value:"Refunded",children:"Refunded"})]})]}),(0,a.jsxs)("div",{className:"form-row",children:[a.jsx("label",{children:"Note"}),a.jsx("textarea",{name:"note",value:h.note,onChange:handleChange,rows:"4"})]}),(0,a.jsxs)("div",{style:{marginTop:12},children:[a.jsx("button",{type:"submit",className:"btn",disabled:x,children:x?"Saving…":"Save changes"}),a.jsx("button",{type:"button",className:"btn ghost",style:{marginLeft:8},onClick:()=>u(),children:"Refresh"})]})]}),(0,a.jsxs)("aside",{children:[(0,a.jsxs)("div",{className:"card",children:[a.jsx("strong",{children:"Order summary"}),(0,a.jsxs)("div",{style:{marginTop:8},className:"kv",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Customer:"})," ",j.firstName," ",j.lastName]}),(0,a.jsxs)("div",{style:{marginTop:6},children:[a.jsx("strong",{children:"Total:"})," ₹",j.totalPrice?.toFixed?.(2)??j.totalPrice]}),(0,a.jsxs)("div",{style:{marginTop:6},children:[a.jsx("strong",{children:"Items:"})," ",j.cartProducts?.length??0]}),(0,a.jsxs)("div",{style:{marginTop:6},children:[a.jsx("strong",{children:"Current status:"})," ",j.orderStatus]})]})]}),(0,a.jsxs)("div",{className:"card",style:{marginTop:12},children:[a.jsx("strong",{children:"Status history"}),a.jsx("div",{style:{marginTop:8},children:a.jsx("ul",{children:Array.isArray(j.statusHistory)&&j.statusHistory.length>0?j.statusHistory.map((e,t)=>(0,a.jsxs)("li",{children:[e.status," — ",e.updatedAt?new Date(e.updatedAt).toLocaleString():"-"]},t)):a.jsx("li",{className:"kv muted",children:"No history"})})})]})]})]})})})]})}s()}catch(e){s(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9816:e=>{e.exports=require("styled-jsx/style")},9648:e=>{e.exports=import("axios")},3590:e=>{e.exports=import("react-toastify")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[761,544,994,450,345,597,142],()=>__webpack_exec__(6222));module.exports=r})();